# Serverless Michael Scott Quotes (Frontend)

This is an simple Frontend for the Demo [Serverless Michael Scott Quotes](https://github.com/Titoeuf/serverless-aws-michaelscott)

This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 7.3.3.

## Getting started

Simply change the `apiBaseUrl` constant in `src/environments/environment.ts` to match the url endpoint generated by your serverless deployement.

## Angular quick tip

### Development server

Run `ng serve` for a dev server. Navigate to `http://localhost:4200/`. The app will automatically reload if you change any of the source files.

### Build

Run `ng build` to build the project. The build artifacts will be stored in the `dist/` directory. Use the `--prod` flag for a production build.

### Further help

To get more help on the Angular CLI use `ng help` or go check out the [Angular CLI README](https://github.com/angular/angular-cli/blob/master/README.md).

## Serverless deployment (AWS)

In order the keep the app completely serverless, you will want to host your frontend using AWS serverless services.  
You can skip step 1 and 2 if you already have a Bucket and CloudFront distribution.

#### 1. Create a new Bucket on S3
The Bucket can be created using the default settings. For more information on creating a Bucket, see this [AWS tutorial](https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html)

> Make sure you create the Bucket in the same region as your serverless function to avoid any extra data transfer costs

#### 2. Create a CloudFront Distribution
Make sure to check the following settings on the creation page : 

* `Origin Name` - Select your S3 Bucket from the dropdown
* `Restrict Bucket Access` - `Yes`, we want the bucket to be only accessible through CloudFront
* `Origin Access Identity` - `Create a New Identity`, we want to create a new role that will let CloudFront access the S3 Bucket
* `Grant Read Permissions on Bucket` - `Yes, Update Bucket Policy`, we let CloudFront set the correct permissions
* `Viewer Protocol Policy` - `Redirect HTTP to HTTPS`, that is usually the wanted behavior
* `Compress Objects Automatically` - `Yes`, let CloudFront automatically gzip compatible files depending on the request header
* `Price Class` - `Use Only U.S., Canada and Europe`, those region costs less for the data transfer. Unless your target audience is in Asia or Africa, always select this.
* `Default Root Object` - `index.html`, we want CloudFront to load our index file automatically

> After creating the distribution, it will take about 15 minutes for it to be ready. Wait for the status to show `Deployed` before testing

#### 3. Compile your project 
Use the command `ng build --prod` to build the Angular project for deployment
> Make sure you updated the production environment variables in `src/environments/environment.prod.ts`

#### 4. Deploy the files
Upload all the content of `dist/serverless-michaelscott` to the S3 Bucket using the default permissions.

#### 5. Invalidate CloudFront cache
Since CloudFront keeps a cache of all the files, you will want to tell it when to refresh its cache.
See this [Amazon documentation](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#Invalidation_Requests) on how to invalidate CloudFront cache.
In our case, you can invalidate the whole bucket using `/*` as an invalidation path

> This needs to be done everytime you change files in the S3 Bucket

#### 6. Access your app
Use the CloudFront generated url to access your app.

> PARKOUR !  
> \- Michael Scott
